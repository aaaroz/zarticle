---
import CategoryView from "@/components/pages/category"
import { articles, categories } from "@/data/articles"
import Layout from "@/layouts/Layout.astro"

// import { getArticleByCategory } from "@/lib/strapi/articles-by-category"
// import { getCategories } from "@/lib/strapi/categories"

const { slug } = Astro.params
// const categories = await getCategories()
// const articles = await getArticleByCategory(slug)

export async function getStaticPaths() {
  return categories.map((cat) => ({
    params: { slug: cat.slug },
  }))
}

const category = categories.find((cat) => cat.slug === slug)

if (!category) {
  throw Astro.redirect("/404")
}

const categoryArticles = articles.filter(
  (article) => article.category.slug === slug,
)
---

<Layout
  title={`${category.name.charAt(0).toUpperCase() + category.name.slice(1)} Articles | zArticle`}
  description={`Explore our ${category.name} articles.`}
>
  <CategoryView
    categoryName={category.name}
    categories={categories}
    articles={categoryArticles}
  />
</Layout>
