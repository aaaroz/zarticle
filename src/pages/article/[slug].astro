---
import ArticlePage from "@/components/pages/article"
// import { getArticleBySlug } from "@/lib/strapi/article-by-slug"
// import { getArticles } from "@/lib/strapi/articles"

import { articles, getArticleBySlug } from "@/data/articles"
import Layout from "@/layouts/Layout.astro"

export async function getStaticPaths() {
  return articles.map((article) => ({
    params: { slug: article.slug },
  }))
}

const { slug } = Astro.params
const article = slug ? getArticleBySlug(slug) : null

if (!article) {
  throw Astro.redirect("/404")
}

const formattedDate = new Date(article.publishedAt).toLocaleDateString(
  "en-US",
  {
    year: "numeric",
    month: "long",
    day: "numeric",
  },
)

// related articles
const relatedArticles = articles
  .filter(
    (a) =>
      a.category === article.category && a.documentId !== article.documentId,
  )
  .slice(0, 2)
---

<Layout
  title={article.title}
  description={article.description}
  image={article.cover.url}
>
  <ArticlePage
    client:load
    article={article}
    relatedArticles={relatedArticles}
    formattedDate={formattedDate}
  />
</Layout>
